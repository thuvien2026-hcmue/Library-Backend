{"version":3,"file":"index.js","names":["opts?: CreateBuilderOptions<TErrorShape>","fastify: FastifyInstance","opts: RouteHandlerOptions<TRouter>","done: (err?: Error) => void"],"sources":["../src/fastify.ts"],"sourcesContent":["import * as Effect from \"effect/Effect\";\nimport type { FastifyInstance, FastifyReply, FastifyRequest } from \"fastify\";\n\nimport type { Json } from \"@uploadthing/shared\";\n\nimport { makeAdapterHandler } from \"./_internal/handler\";\nimport { toWebRequest } from \"./_internal/to-web-request\";\nimport type { CreateBuilderOptions } from \"./_internal/upload-builder\";\nimport { createBuilder } from \"./_internal/upload-builder\";\nimport type { FileRouter, RouteHandlerOptions } from \"./types\";\n\nexport {\n  UTFiles,\n  /**\n   * This is an experimental feature.\n   * You need to be feature flagged on our backend to use this\n   */\n  UTRegion as experimental_UTRegion,\n} from \"./_internal/types\";\nexport type { FileRouter };\n\ntype AdapterArgs = {\n  req: FastifyRequest;\n  res: FastifyReply;\n};\n\nexport const createUploadthing = <TErrorShape extends Json>(\n  opts?: CreateBuilderOptions<TErrorShape>,\n) => createBuilder<AdapterArgs, TErrorShape>(opts);\n\nexport const createRouteHandler = <TRouter extends FileRouter>(\n  fastify: FastifyInstance,\n  opts: RouteHandlerOptions<TRouter>,\n  done: (err?: Error) => void,\n) => {\n  const handler = makeAdapterHandler<\n    [FastifyRequest, FastifyReply],\n    AdapterArgs\n  >(\n    (req, res) => Effect.succeed({ req, res }),\n    (req) => toWebRequest(req),\n    opts,\n    \"fastify\",\n  );\n\n  fastify.all(\"/api/uploadthing\", async (req, res) => {\n    const response = await handler(req, res);\n    return res\n      .status(response.status)\n      .headers(Object.fromEntries(response.headers))\n      .send(response.body);\n  });\n\n  done();\n};\n"],"mappings":";;;;;;;;AA0BA,MAAa,oBAAoB,CAC/BA,SACG,cAAwC,KAAK;AAElD,MAAa,qBAAqB,CAChCC,SACAC,MACAC,SACG;CACH,MAAM,UAAU,mBAId,CAAC,KAAK,QAAQ,OAAO,QAAQ;EAAE;EAAK;CAAK,EAAC,EAC1C,CAAC,QAAQ,aAAa,IAAI,EAC1B,MACA,UACD;CAED,QAAQ,IAAI,oBAAoB,OAAO,KAAK,QAAQ;EAClD,MAAM,WAAW,MAAM,QAAQ,KAAK,IAAI;AACxC,SAAO,IACJ,OAAO,SAAS,OAAO,CACvB,QAAQ,OAAO,YAAY,SAAS,QAAQ,CAAC,CAC7C,KAAK,SAAS,KAAK;CACvB,EAAC;CAEF,MAAM;AACP"}